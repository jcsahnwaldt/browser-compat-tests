<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
</head>
<body style="margin: 0px">
<script>
"use strict";

let params = (new URL(document.location)).searchParams;
let width = parseInt(params.get('w'));
let height = parseInt(params.get('h'));

let canvas = document.createElement('canvas');
canvas.style.position = 'absolute';
canvas.style.left = '0px';
canvas.style.top = '0px';
canvas.width = width;
canvas.height = height;
document.body.prepend(canvas);

let ctx = canvas.getContext('2d');
let img = ctx.createImageData(width, height);
let px = img.data;

inixelate();

function inixelate() {
  for (let i = 0; i < px.length; i++) {
    if ((i + 1) % 4 === 0) px[i] = 0xFF; // set alpha byte
    else if ((i + 2) % (4 * width) === 0) px[i] = 0x0A; // LF at end of line
    else px[i] = 0x20; // SP
  }
  ctx.putImageData(img, 0, 0);
}

function utf8len(b) {
  return b >= 0b11110000 ? 4 : b >= 0b11100000 ? 3 : b >= 0b11000000 ? 2 : 1;
}

function pixelate(y, s) {
  if (y >= height) return;

  // convert to UTF-8 bytes
  s = unescape(encodeURIComponent(s));

  // max length: 3 bytes per pixel, minus 1 byte for LF
  let m = Math.min(s.length, 3 * width - 1);
  for (let c = 0, i = y * 4 * width; c < m; c++, i++) {
    let b = s.charCodeAt(c);
    if (c + utf8len(b) > m) break; // not enough space for all UTF-8 bytes - don't print any
    if ((i + 1) % 4 === 0) i++; // skip alpha byte
    px[i] = b;
  }
  ctx.putImageData(img, 0, 0);
}

</script>
<script>
"use strict";

var lines = [
"Lorem ipsum dolor sit amet,",
"consectetur adipiscing elit,",
"sed do eiusmod tempor incididunt",
"ut labore et dolore magna aliqua.",
"Ut enim ad minim veniam, quis nostrud",
"exercitation ullamco laboris nisi",
"ut aliquip ex ea commodo consequat.",
"Düîs äüté îrüré dölör în répréhéndérît",
"in voluptate velit esse cillum",
"dolore eu fugiat nulla pariatur.",
"Excepteur sint occaecat cupidatat non",
"proident, sunt in culpa qui officia",
"deserunt mollit anim id est laborum.",
"🧐🧑🧒🧓🧔🧕🧖🧗🧘🧙🧚🧛🧜🧝🧞🧟"
];

for (let i = 0; i < lines.length; i++) {
  pixelate(i, lines[i]);
}

</script>
</body>
</html>
